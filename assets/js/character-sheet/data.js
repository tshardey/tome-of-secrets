// Import data from JSON files (source of truth)
// These exports are generated by: node scripts/generate-data.js
import { 
    xpLevels, 
    permanentBonuses, 
    atmosphericBuffs,
    schoolBenefits,
    sanctumBenefits,
    keeperBackgrounds,
    allItems,
    dungeonRooms,
    masteryAbilities,
    dungeonRewards,
    dungeonCompletionRewards,
    allGenres,
    genreQuests,
    extraCreditRewards,
    sideQuestsDetailed,
    curseTableDetailed,
    temporaryBuffsFromRewards,
    temporaryBuffs,
    levelRewards,
    shoppingOptions
} from './data.json-exports.js';

// Re-export JSON data for backward compatibility
export { xpLevels, permanentBonuses, atmosphericBuffs, schoolBenefits, sanctumBenefits, keeperBackgrounds, allItems, dungeonRooms, masteryAbilities, dungeonRewards, dungeonCompletionRewards, allGenres, genreQuests, extraCreditRewards, sideQuestsDetailed, curseTableDetailed, temporaryBuffsFromRewards, temporaryBuffs, levelRewards, shoppingOptions };

// atmosphericBuffs and other data are now imported from JSON exports above

// Derived, backward-compatible shapes from detailed JSON (single source of truth)
export const sideQuests = (() => {
    const result = {};
    for (const key of Object.keys(sideQuestsDetailed)) {
        const sq = sideQuestsDetailed[key];
        // "N: Name: prompt"
        result[key] = `${sq.name}: ${sq.prompt}`;
    }
    return result;
})();

export const curseTable = (() => {
    // Convert detailed array into keyed object with requirement pulled from description semantics
    // Our detailed format does not carry a separate "requirement" field, so we infer from description
    // For backward compatibility, we map requirement to the sentence after the first period if present,
    // and normalize it by removing a leading "You must " and trailing punctuation.
    const result = {};
    const normalizeRequirement = (text) => {
        let req = (text || '').trim();
        const lower = req.toLowerCase();
        if (lower.startsWith('you must ')) {
            req = req.substring(9);
        }
        if (req.endsWith('.')) {
            req = req.substring(0, req.length - 1);
        }
        return req.trim();
    };
    for (const entry of curseTableDetailed) {
        const { name, description } = entry;
        let requirementText = description;
        const periodIndex = description.indexOf('. ');
        if (periodIndex !== -1) {
            requirementText = description.substring(periodIndex + 2);
        }
        const requirement = normalizeRequirement(requirementText);
        result[name] = {
            name,
            requirement,
            description
        };
    }
    return result;
})();